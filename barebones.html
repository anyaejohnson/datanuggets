<html>
<head>

<script src="knockout-3.2.0.js" type="text/javascript"></script>
<link href="c3.css" rel="stylesheet" type="text/css">
<script src="d3.min.js" charset="utf-8"></script>
<script src="c3.min.js"></script>

</head>
<body>
  <h2>Select Your Data Set</h2>
  <table>
    <thead><tr>
      <th> </th><th></th><th>Data Set Options</th><th></th>
    </tr></thead>
    <tbody data-bind="foreach: datasets">
      <tr>
        <td data-bind="text: name"></td>
        <td></td>
        <td><select data-bind="options: $root.optionValues, value: col_name"></td>
      </tr>
    </tbody>
  </table>
  <h2>Select Your Variables </h2>
 <table>
   <thead><tr>
     <th>Variable Type</th><th></th><th>Variable</th><th></th>
   </tr></thead>
   <tbody data-bind="foreach: variables">
     <tr>
       <td data-bind="text: name"></td>
       <td></td>
       <td><select data-bind="options: $root.variableList, value: col_name"></td>
     </tr>
   </tbody>
 </table>
 <script type="text/javascript">
   //TODO: check boxes for categorical variables
   var setData = ["Invasive Species", "Blah 1", "Blah 2"];
   var columnData = ["Insects Average", "Percent Damage"];
   //var lineData = ['{"status":"invasive", "insects_avg":9, "perc_damage":67.5}', '{"status":"invasive", "insects_avg":8, "perc_damage":33.9}', '{"status":"native", "insects_avg":10, "perc_damage":10.4}','{"status":"native", "insects_avg":10, "perc_damage":21.6}'];
   
   //concatenate json from two column calls
   var lineData = ['{"insects_avg":9, "perc_damage":67.5}', '{"insects_avg":8, "perc_damage":33.9}', '{"insects_avg":10, "perc_damage":10.4}','{"insects_avg":10, "perc_damage":21.6}'];
   var keys_obj = JSON.parse(lineData[0]);
   var keys = Object.keys(keys_obj);
   
 // Class to represent predictor and response variables
 function NewVariable(name, defaultVariable) {
 var self = this;
 self.name = name;
 self.col_name = ko.observable(defaultVariable);
 }
 
 // Overall viewmodel, along with initial state
 function DNViewModel() {
   var self = this;
   // List of column names within data
   self.variableList = keys;
   //self.setList = JSON.parse(setData);
   self.optionValues=setData;
 
  self.datasets = ko.observableArray([new NewVariable("Data Set", "Select One")]);
 
 //Code for dropdown menus to pick variables to use
  self.variables = ko.observableArray([
                                       new NewVariable("Predictor Variable", self.variableList[0]),
                                       new NewVariable("Response Variable", self.variableList[0])
                                       ]);
 }
 
 var myViewModel = new DNViewModel();
 ko.applyBindings(myViewModel);
 
 //Update column name choices when data set is chosen
 myViewModel.optionValues().col_name.subscribe(
                                               function(newValue) {
                                               //HTTP GET pulling columns of dataset chosen
                                               var chosenSet = newValue;
                                               //do wahtever we need to to make the url properly
                                               //$.getJSON("/some/url", function(data) {
                                               // Now use this data to update your view models,
                                               // and Knockout will update your UI automatically
                                               //keys = data;
                                               //})
                                               });



 </script>

<h2>Graph </h2>


<div id="chart"></div>
<script>
  //TODO: Generate and update axis labels automatically with variable names by hard pulling
  x_value = "";
  y_value = "";
  x_data = [];
  y_data = [];
  myViewModel.variables()[0].col_name.subscribe(
      function(newValue) {
                                  x_value = newValue;
                                  x_data = ['x'];
                                  //request the new column's data and then load chart
                                  //$.getJSON("/some/url", function(data) {
                                  // Now use this data to update your view models,
                                  // and Knockout will update your UI automatically
                                  //x_data.push(data);
                                  //})
                                  
                                  

                                  for (i=0; i<lineData.length; i++){
                                       temp_obj = JSON.parse(lineData[i]);
                                       x_data.push(temp_obj[x_value]);
                                  }
                                  chart.load({columns:[x_data, y_data]
                                  });
                                  
       });
       
       x_value = myViewModel.variables()[0].col_name();
       x_data = ['x'];
       
       for (i=0; i<lineData.length; i++){
         temp_obj = JSON.parse(lineData[i]);
         x_data.push(temp_obj[x_value]);
       }

  myViewModel.variables()[1].col_name.subscribe(
                 function(newValue) {
                         y_value = newValue;
                         y_data = ['y'];
                         //request the new column's data and then load chart
                         //$.getJSON("/some/url", function(data) {
                         // Now use this data to update your view models,
                         // and Knockout will update your UI automatically
                         //y_data.push(data);
                         //})
                                                                                     
                         for (i=0; i<lineData.length; i++){
                               temp_obj = JSON.parse(lineData[i]);
                               y_data.push(temp_obj[y_value]);
                          }
                          chart.load({
                                columns:[x_data, y_data]
                              });
                                                                                     
                  });
  y_value = myViewModel.variables()[1].col_name();
  y_data = ['y'];
                  
  for (i=0; i<lineData.length; i++){
     temp_obj = JSON.parse(lineData[i]);
     y_data.push(temp_obj[y_value]);
                  }

  var chart = c3.generate({
                          bindto: '#chart',
                          data: {
                            x: 'x',
                            columns: [
                                      x_data,
                                      y_data
                            ],
                            type: 'scatter'
                          },
                          legend: {
                            show: false
                          },
                          
                          axis: {
                            x: {
                              label: {
                                text: 'Predictor Variable',
                                position: 'outer-center'
                              }
                            },
                            y: {
                              label: {
                              text: 'Response Variable',
                              position: 'outer-middle'
                              }
                            }
                          }
                          
  });
</script>

</body>
</html>